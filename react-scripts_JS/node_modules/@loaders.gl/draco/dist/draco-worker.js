(()=>{var Dt="beta",C=typeof __VERSION__!="undefined"?__VERSION__:Dt;typeof __VERSION__=="undefined"&&console.error("loaders.gl: The __VERSION__ variable is not injected using babel plugin. Latest unstable workers would be fetched from the CDN.");function tt(r,t){if(!r)throw new Error(t||"loaders.gl assertion failed.")}var g={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document},ne=g.self||g.window||g.global||{},se=g.window||g.self||g.global||{},et=g.global||g.self||g.window||{},ie=g.document||{};var P=typeof process!="object"||String(process)!=="[object process]"||process.browser,B=typeof importScripts=="function",ce=typeof window!="undefined"&&typeof window.orientation!="undefined",rt=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version),de=rt&&parseFloat(rt[1])||0;function W(r,t=!0,e){let o=e||new Set;if(r){if(ot(r))o.add(r);else if(ot(r.buffer))o.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(t&&typeof r=="object")for(let n in r)W(r[n],t,o)}}return e===void 0?Array.from(o):[]}function ot(r){return r?r instanceof ArrayBuffer||typeof MessagePort!="undefined"&&r instanceof MessagePort||typeof ImageBitmap!="undefined"&&r instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&r instanceof OffscreenCanvas:!1}var U=new Map,p=class{static set onmessage(t){self.onmessage=e=>{if(!at(e))return;let{type:o,payload:n}=e.data;t(o,n)}}static addEventListener(t){let e=U.get(t);e||(e=o=>{if(!at(o))return;let{type:n,payload:s}=o.data;t(n,s)}),self.addEventListener("message",e)}static removeEventListener(t){let e=U.get(t);U.delete(t),self.removeEventListener("message",e)}static postMessage(t,e){if(self){let o={source:"loaders.gl",type:t,payload:e},n=W(e);self.postMessage(o,n)}}};function at(r){let{type:t,data:e}=r;return t==="message"&&e&&typeof e.source=="string"&&e.source.startsWith("loaders.gl")}var xt="beta",Mt=typeof C!="undefined"?C:xt,z={};async function M(r,t=null,e={}){return t&&(r=nt(r,t,e)),z[r]=z[r]||wt(r),await z[r]}function nt(r,t,e){if(r.startsWith("http"))return r;let o=e.modules||{};return o[r]?o[r]:P?e.CDN?(tt(e.CDN.startsWith("http")),`${e.CDN}/${t}@${Mt}/dist/libs/${r}`):B?`../src/libs/${r}`:`modules/${t}/src/libs/${r}`:`modules/${t}/dist/libs/${r}`}async function wt(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!P)return x.requireFromFile&&await x.requireFromFile(r);if(B)return importScripts(r);let e=await(await fetch(r)).text();return It(e,r)}function It(r,t){if(!P)return x.requireFromString&&x.requireFromString(r,t);if(B)return eval.call(et,r),null;let e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(r))}catch{e.text=r}return document.body.appendChild(e),null}var _t=0;function $(r){typeof self!="undefined"&&(p.onmessage=async(t,e)=>{switch(t){case"process":try{let{input:o,options:n={}}=e,s=await Tt({loader:r,arrayBuffer:o,options:n,context:{parse:St}});p.postMessage("done",{result:s})}catch(o){let n=o instanceof Error?o.message:"";p.postMessage("error",{error:n})}break;default:}})}function St(r,t){return new Promise((e,o)=>{let n=_t++,s=(d,l)=>{if(l.id===n)switch(d){case"done":p.removeEventListener(s),e(l.result);break;case"error":p.removeEventListener(s),o(l.error);break;default:}};p.addEventListener(s);let i={id:n,input:r,options:t};p.postMessage("process",i)})}async function Tt({loader:r,arrayBuffer:t,options:e,context:o}){let n,s;if(r.parseSync||r.parse)n=t,s=r.parseSync||r.parse;else if(r.parseTextSync)n=new TextDecoder().decode(t),s=r.parseTextSync;else throw new Error(`Could not load data with ${r.name} loader`);return e={...e,modules:r&&r.options&&r.options.modules||{},worker:!1},await s(n,{...e},o,r)}var st=typeof __VERSION__!="undefined"?__VERSION__:"latest";var Ot={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},it={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:st,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:Ot};function V(r){let t=1/0,e=1/0,o=1/0,n=-1/0,s=-1/0,i=-1/0,d=r.POSITION?r.POSITION.value:[],l=d&&d.length;for(let f=0;f<l;f+=3){let y=d[f],A=d[f+1],D=d[f+2];t=y<t?y:t,e=A<e?A:e,o=D<o?D:o,n=y>n?y:n,s=A>s?A:s,i=D>i?D:i}return[[t,e,o],[n,s,i]]}function ct(r,t){if(!r)throw new Error(t||"loader assertion failed.")}var m=class{constructor(t,e){ct(Array.isArray(t)),Lt(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata||this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...t){let e=Object.create(null);for(let n of t)e[n]=!0;let o=this.fields.filter(n=>e[n.name]);return new m(o,this.metadata)}selectAt(...t){let e=t.map(o=>this.fields[o]).filter(Boolean);return new m(e,this.metadata)}assign(t){let e,o=this.metadata;if(t instanceof m){let i=t;e=i.fields,o=dt(dt(new Map,this.metadata),i.metadata)}else e=t;let n=Object.create(null);for(let i of this.fields)n[i.name]=i;for(let i of e)n[i.name]=i;let s=Object.values(n);return new m(s,o)}};function Lt(r){let t={};for(let e of r)t[e.name]&&console.warn("Schema: duplicated field name",e.name,e),t[e.name]=!0}function dt(r,t){return new Map([...r||new Map,...t||new Map])}var h=class{constructor(t,e,o=!1,n=new Map){this.name=t,this.type=e,this.nullable=o,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new h(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?`, metadata: ${this.metadata}`:""}`}};var c;(function(a){a[a.NONE=0]="NONE",a[a.Null=1]="Null",a[a.Int=2]="Int",a[a.Float=3]="Float",a[a.Binary=4]="Binary",a[a.Utf8=5]="Utf8",a[a.Bool=6]="Bool",a[a.Decimal=7]="Decimal",a[a.Date=8]="Date",a[a.Time=9]="Time",a[a.Timestamp=10]="Timestamp",a[a.Interval=11]="Interval",a[a.List=12]="List",a[a.Struct=13]="Struct",a[a.Union=14]="Union",a[a.FixedSizeBinary=15]="FixedSizeBinary",a[a.FixedSizeList=16]="FixedSizeList",a[a.Map=17]="Map",a[a.Dictionary=-1]="Dictionary",a[a.Int8=-2]="Int8",a[a.Int16=-3]="Int16",a[a.Int32=-4]="Int32",a[a.Int64=-5]="Int64",a[a.Uint8=-6]="Uint8",a[a.Uint16=-7]="Uint16",a[a.Uint32=-8]="Uint32",a[a.Uint64=-9]="Uint64",a[a.Float16=-10]="Float16",a[a.Float32=-11]="Float32",a[a.Float64=-12]="Float64",a[a.DateDay=-13]="DateDay",a[a.DateMillisecond=-14]="DateMillisecond",a[a.TimestampSecond=-15]="TimestampSecond",a[a.TimestampMillisecond=-16]="TimestampMillisecond",a[a.TimestampMicrosecond=-17]="TimestampMicrosecond",a[a.TimestampNanosecond=-18]="TimestampNanosecond",a[a.TimeSecond=-19]="TimeSecond",a[a.TimeMillisecond=-20]="TimeMillisecond",a[a.TimeMicrosecond=-21]="TimeMicrosecond",a[a.TimeNanosecond=-22]="TimeNanosecond",a[a.DenseUnion=-23]="DenseUnion",a[a.SparseUnion=-24]="SparseUnion",a[a.IntervalDayTime=-25]="IntervalDayTime",a[a.IntervalYearMonth=-26]="IntervalYearMonth"})(c||(c={}));var u=class{static isNull(t){return t&&t.typeId===c.Null}static isInt(t){return t&&t.typeId===c.Int}static isFloat(t){return t&&t.typeId===c.Float}static isBinary(t){return t&&t.typeId===c.Binary}static isUtf8(t){return t&&t.typeId===c.Utf8}static isBool(t){return t&&t.typeId===c.Bool}static isDecimal(t){return t&&t.typeId===c.Decimal}static isDate(t){return t&&t.typeId===c.Date}static isTime(t){return t&&t.typeId===c.Time}static isTimestamp(t){return t&&t.typeId===c.Timestamp}static isInterval(t){return t&&t.typeId===c.Interval}static isList(t){return t&&t.typeId===c.List}static isStruct(t){return t&&t.typeId===c.Struct}static isUnion(t){return t&&t.typeId===c.Union}static isFixedSizeBinary(t){return t&&t.typeId===c.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===c.FixedSizeList}static isMap(t){return t&&t.typeId===c.Map}static isDictionary(t){return t&&t.typeId===c.Dictionary}get typeId(){return c.NONE}compareTo(t){return this===t}},q=class extends u{get typeId(){return c.Null}get[Symbol.toStringTag](){return"Null"}toString(){return"Null"}},G=class extends u{get typeId(){return c.Bool}get[Symbol.toStringTag](){return"Bool"}toString(){return"Bool"}},b=class extends u{constructor(t,e){super();this.isSigned=t,this.bitWidth=e}get typeId(){return c.Int}get[Symbol.toStringTag](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}},w=class extends b{constructor(){super(!0,8)}},I=class extends b{constructor(){super(!0,16)}},_=class extends b{constructor(){super(!0,32)}};var S=class extends b{constructor(){super(!1,8)}},T=class extends b{constructor(){super(!1,16)}},O=class extends b{constructor(){super(!1,32)}};var lt={HALF:16,SINGLE:32,DOUBLE:64},L=class extends u{constructor(t){super();this.precision=t}get typeId(){return c.Float}get[Symbol.toStringTag](){return"Float"}toString(){return`Float${this.precision}`}};var E=class extends L{constructor(){super(lt.SINGLE)}},N=class extends L{constructor(){super(lt.DOUBLE)}},Q=class extends u{constructor(){super()}get typeId(){return c.Binary}toString(){return"Binary"}get[Symbol.toStringTag](){return"Binary"}},Y=class extends u{get typeId(){return c.Utf8}get[Symbol.toStringTag](){return"Utf8"}toString(){return"Utf8"}},Et={DAY:0,MILLISECOND:1},j=class extends u{constructor(t){super();this.unit=t}get typeId(){return c.Date}get[Symbol.toStringTag](){return"Date"}toString(){return`Date${(this.unit+1)*32}<${Et[this.unit]}>`}};var ut={SECOND:1,MILLISECOND:1e3,MICROSECOND:1e6,NANOSECOND:1e9},H=class extends u{constructor(t,e){super();this.unit=t,this.bitWidth=e}get typeId(){return c.Time}toString(){return`Time${this.bitWidth}<${ut[this.unit]}>`}get[Symbol.toStringTag](){return"Time"}};var J=class extends u{constructor(t,e=null){super();this.unit=t,this.timezone=e}get typeId(){return c.Timestamp}get[Symbol.toStringTag](){return"Timestamp"}toString(){return`Timestamp<${ut[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}};var Nt={DAY_TIME:0,YEAR_MONTH:1},X=class extends u{constructor(t){super();this.unit=t}get typeId(){return c.Interval}get[Symbol.toStringTag](){return"Interval"}toString(){return`Interval<${Nt[this.unit]}>`}};var F=class extends u{constructor(t,e){super();this.listSize=t,this.children=[e]}get typeId(){return c.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Symbol.toStringTag](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}},Z=class extends u{constructor(t){super();this.children=t}get typeId(){return c.Struct}toString(){return`Struct<{${this.children.map(t=>`${t.name}:${t.type}`).join(", ")}}>`}get[Symbol.toStringTag](){return"Struct"}};function mt(r){switch(r.constructor){case Int8Array:return new w;case Uint8Array:return new S;case Int16Array:return new I;case Uint16Array:return new T;case Int32Array:return new _;case Uint32Array:return new O;case Float32Array:return new E;case Float64Array:return new N;default:throw new Error("array type not supported")}}function K(r,t,e){let o=mt(t.value),n=e||pt(t);return new h(r,new F(t.size,new h("value",o)),!1,n)}function pt(r){let t=new Map;return"byteOffset"in r&&t.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&t.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&t.set("normalized",r.normalized.toString()),t}function ft(r,t,e){let o=gt(t.metadata),n=[],s=Gt(t.attributes);for(let i in r){let d=r[i],l=yt(i,d,s[i]);n.push(l)}if(e){let i=yt("indices",e);n.push(i)}return new m(n,o)}function Gt(r){let t={};for(let e in r){let o=r[e];t[o.name||"undefined"]=o}return t}function yt(r,t,e){let o=e?gt(e.metadata):void 0;return K(r,t,o)}function gt(r){let t=new Map;for(let e in r)t.set(`${e}.string`,JSON.stringify(r[e]));return t}var ht={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Qt={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Yt=4,v=class{constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){let o=new this.draco.DecoderBuffer;o.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);let n=this.decoder.GetEncodedGeometryType(o),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let i;switch(n){case this.draco.TRIANGULAR_MESH:i=this.decoder.DecodeBufferToMesh(o,s);break;case this.draco.POINT_CLOUD:i=this.decoder.DecodeBufferToPointCloud(o,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!i.ok()||!s.ptr){let D=`DRACO decompression failed: ${i.error_msg()}`;throw new Error(D)}let d=this._getDracoLoaderData(s,n,e),l=this._getMeshData(s,d,e),f=V(l.attributes),y=ft(l.attributes,d,l.indices);return{loader:"draco",loaderData:d,header:{vertexCount:s.num_points(),boundingBox:f},...l,schema:y}}finally{this.draco.destroy(o),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,e,o){let n=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,o);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(t,e){let o={};for(let n=0;n<t.num_attributes();n++){let s=this.decoder.GetAttribute(t,n),i=this._getAttributeMetadata(t,n);o[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:i};let d=this._getQuantizationTransform(s,e);d&&(o[s.unique_id()].quantization_transform=d);let l=this._getOctahedronTransform(s,e);l&&(o[s.unique_id()].octahedron_transform=l)}return o}_getMeshData(t,e,o){let n=this._getMeshAttributes(e,t,o);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(o.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,e,o){let n={};for(let s of Object.values(t.attributes)){let i=this._deduceAttributeName(s,o);s.name=i;let{value:d,size:l}=this._getAttributeValues(e,s);n[i]={value:d,size:l,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}return n}_getTriangleListIndices(t){let o=t.num_faces()*3,n=o*Yt,s=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,s),new Uint32Array(this.draco.HEAPF32.buffer,s,o).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){let e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),Jt(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){let o=Qt[e.data_type],n=e.num_components,i=t.num_points()*n,d=i*o.BYTES_PER_ELEMENT,l=jt(this.draco,o),f,y=this.draco._malloc(d);try{let A=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,A,l,d,y),f=new o(this.draco.HEAPF32.buffer,y,i).slice()}finally{this.draco._free(y)}return{value:f,size:n}}_deduceAttributeName(t,e){let o=t.unique_id;for(let[i,d]of Object.entries(e.extraAttributes||{}))if(d===o)return i;let n=t.attribute_type;for(let i in ht)if(this.draco[i]===n)return ht[i];let s=e.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:`CUSTOM_ATTRIBUTE_${o}`}_getTopLevelMetadata(t){let e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){let o=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(o)}_getDracoMetadata(t){if(!t||!t.ptr)return{};let e={},o=this.metadataQuerier.NumEntries(t);for(let n=0;n<o;n++){let s=this.metadataQuerier.GetEntryName(t,n);e[s]=this._getDracoMetadataField(t,s)}return e}_getDracoMetadataField(t,e){let o=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,o);let n=Ht(o);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(o)}}_disableAttributeTransforms(t){let{quantizedAttributes:e=[],octahedronAttributes:o=[]}=t,n=[...e,...o];for(let s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,e){let{quantizedAttributes:o=[]}=e,n=t.attribute_type();if(o.map(i=>this.decoder[i]).includes(n)){let i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(t))return{quantization_bits:i.quantization_bits(),range:i.range(),min_values:new Float32Array([1,2,3]).map(d=>i.min_value(d))}}finally{this.draco.destroy(i)}}return null}_getOctahedronTransform(t,e){let{octahedronAttributes:o=[]}=e,n=t.attribute_type();if(o.map(i=>this.decoder[i]).includes(n)){let i=new this.draco.AttributeQuantizationTransform;try{if(i.InitFromAttribute(t))return{quantization_bits:i.quantization_bits()}}finally{this.draco.destroy(i)}}return null}};function jt(r,t){switch(t){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function Ht(r){let t=r.size(),e=new Int32Array(t);for(let o=0;o<t;o++)e[o]=r.GetValue(o);return e}function Jt(r){let t=r.size(),e=new Int32Array(t);for(let o=0;o<t;o++)e[o]=r.GetValue(o);return e}var R="1.4.1",Xt=`https://www.gstatic.com/draco/versioned/decoders/${R}/draco_decoder.js`,Zt=`https://www.gstatic.com/draco/versioned/decoders/${R}/draco_wasm_wrapper.js`,Kt=`https://www.gstatic.com/draco/versioned/decoders/${R}/draco_decoder.wasm`,ir=`https://raw.githubusercontent.com/google/draco/${R}/javascript/draco_encoder.js`,k;async function bt(r){let t=r.modules||{};return t.draco3d?k=k||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):k=k||te(r),await k}async function te(r){let t,e;switch(r.draco&&r.draco.decoderType){case"js":t=await M(Xt,"draco",r);break;case"wasm":default:[t,e]=await Promise.all([await M(Zt,"draco",r),await M(Kt,"draco",r)])}return t=t||globalThis.DracoDecoderModule,await ee(t,e)}function ee(r,t){let e={};return t&&(e.wasmBinary=t),new Promise(o=>{r({...e,onModuleLoaded:n=>o({draco:n})})})}var At={...it,parse:re};async function re(r,t){let{draco:e}=await bt(t),o=new v(e);try{return o.parseSync(r,t?.draco)}finally{o.destroy()}}$(At);})();
//# sourceMappingURL=draco-worker.js.map
